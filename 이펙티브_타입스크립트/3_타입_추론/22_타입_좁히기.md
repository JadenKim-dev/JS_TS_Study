# 22. 타입 좁히기

타입 좁히기는 넓은 타입에서 더 좁은 타입으로 바꿔서 추론하는 것을 의미한다.

## 타입을 좁히는 방법

보통 분기문을 통해서 타입을 좁히는 과정이 진행되는데, 대표적인 예시가 null 체크이다.  
아래 예시에서는 null 체크를 통해 HTMLElement로 타입을 좁힐 수 있었다.

```ts
const el = document.getElementById('foo'); // HTMLElement | null
if (el) {
  el; // HTMLElement
} else {
  el; // null
}
```

분기문 안에서 예외를 던지거나 값을 return 하면 분기문 밖의 타입에도 영향을 줄 수 있다.   
아래 예시에서는 el이 null일 경우 예외를 던져서, 분기문 밖에서의 타입이 HTMLElement가 될 수 있게 했다.

```ts
const el = document. getElementByld ('foo'); // HTMLElement | null
if (!el) throw new Error('Unable to find #foo');
el; // HTMLElement
```

null 체크 이외에도 다양한 방법으로 타입을 좁힐 수 있다.  
다음 예시에서는 instanceof를 사용하여 RegExp로 타입을 좁혔다.

```ts
function contains(text: string, search: string | RegExp) {
  if (search instanceof RegExp) {
    search; // 타입이 RegExp
    return !!search.exec(text);
  }
  search; // 타입이 string
  return text.includes(search);
}
```

속성 체크로도 타입을 좁힐 수 있다.  
각 타입을 구분하는 속성을 체크하여 타입을 좁힌다.

```ts
interface A { a: number }
interface B { b: number }

function pickAB(ab: A | B) {
    if ('a' in ab) {
        ab // 타입이 A
    } else {
        ab // 타입이 B
    }
}
```

Array.isArray와 같은 내장 함수로도 타입을 좁힐 수 있다.  
아래의 예시에서는 terms의 타입을 좁혀서, string일 경우 배열로 감싸게 하여 일관되게 string[] 타입을 가지게 했다.

```ts
function contains(text: string, terms: string | string[]) {
    const termList = Array.isArray(terms) ? terms : [terms];
    termList // 타입이 string []
    // ...
}
```

## 타입 좁히기에서 하기 쉬운 실수들

타입 관련 오류를 범하면 타입 좁히기를 실패할 수 있다.  
예를 들어 null 체크를 위해 typeof가 object인 조건으로 거르면, null도 마찬가지로 object이기 때문에 타입이 좁혀지지 않는다.

```ts
const el = document.getElementById('foo'); // HTMLElement | null
if (typeof el === 'object') {
    el; // HTMLElement | null
}
```



